{
	"name": "Markdown (Typewriter)",
	"author": "Alex Armstrong (@alehandrof)",
	"uuid": "ac344730-1a2b-11e3-8ffd-0800200c9a66",
	"scopeName": "text.html.markdown",
	"fileTypes": [
		/**
		 * Source: http://superuser.com/questions/249436/file-extension-for-markdown-files
		 */
		"md", // the first item becomes the default extension when saving new files
		"markdown",
		"mdown",
		"mdwn",
		"mkd",
		"mkdn",
		"txt",
		"text",
	],
	"patterns": [
		/**
		 * Outside the repo (i.e., block-level):
		 * - Headings
		 * - Lists -> markup.list
		 * 		- Ordered -> .numbered
		 * 		- Unordered -> .unnumbered
		 * 		- Definition
		 * - Blockquotes
		 * - Ruler -> meta.separator.markdown
		 * - Code blocks (fenced or indented)
		 * - Tables -> markup/meta.table.multimarkdown
		 * - Link references -> meta.link.reference.def.markdown
		 * - Paragraphs -> meta.paragraph.markdown
		 */
		{ "include": "#block" },
		{ "include": "#inline" },
	],
	"repository": {

		/* BLOCK Elements - - - - - - - - - - - - - - - - - - - - - - - -  */

		"block": {
			"patterns": [
				{ "include": "#horizontal-rule"},
				{ "include": "#list" },
				{ "include": "#code" },
				{ "include": "#heading" },
				{ "include": "#blockquote" },
				{ "include": "#link-definition" },
				{ "include": "#paragraph"},
			]
		},

		/* BLOCK: Code */
		"code": {
			"patterns": [
				{ "include": "#fenced-code" },
				{ "include": "#indented-code" },
			]
		},
		"fenced-code": {
			/**
			 * Support: backtick & tiled, optional syntax definition
			 * http://johnmacfarlane.net/pandoc/README.html#fenced-code-blocks
			 */
			"name": "markup.raw.block.fenced.markdown",
			"begin": "^(`{3,}|~{3,})(\\S*)?\\s*$",
			"captures": {
				"1": { "name": "punctuation.definition.raw.block.fenced.markdown" },
				"2": { "name": "variable.syntax.raw.block.fenced.markdown" },
			},
			"end": "(\\1)(?=\\n)",
		},
		"indented-code": {
			"name": "markup.raw.block.indented.markdown",
			"begin": "^([ ]{4}|\\t)",
			"end": "$",
		},

		/* BLOCK: Heading */
		"heading": {
			"patterns": [
				// { "include": "#setex-heading" },
				{ "include": "#atx-heading" },
			]
		},
		"atx-heading": {
			"name": "markup.heading.markdown",
			"begin": "^(#{1,6})\\s+(?=\\S)",
			"captures": {
				"1": { "name": "punctuation.definition.heading.markdown" },
			},
			"end": "(\\s+#+)?(?=\\n)",
			"patterns": [ { "include": "#inline" } ]
		},

		/* BLOCK: List */
		"list": {
			"patterns": [
				{ "include": "#task-list" },
				{ "include": "#unordered-list" },
				{ "include": "#ordered-list" },
			]
		},
		"task-list": {
			/**
			 * Source: GFM
			 */
			"name": "markup.list.task.markdown",
			"begin": "^\\s*([-\\+\\*])\\s+(?=\\[[ xX]\\])",
			"captures": {
				"1": { "name": "punctuation.definition.list.task.markdown" },
			},
			"end": "(\\n|$)",
			"patterns": [
				{
					"name": "punctuation.definition.list.task.checkbox.complete.markdown",
					"match": "\\G\\[[xX]\\]",
				},
				{
					"name": "punctuation.definition.list.task.checkbox.incomplete.markdown",
					"match": "\\G\\[ \\]",
				},
				{ "include": "#inline" },
			]
		},
		"unordered-list": {
			/**
			 * Support: underline, hyphen, asterisk
			 */
			"name": "markup.list.unordered.markdown",
			"begin": "^\\s*([-\\+\\*])\\s+",
			"captures": {
				"1": { "name": "punctuation.definition.list.unordered.markdown" },
			},
			"end": "(\\n|$)",
			"patterns": [ { "include": "#inline" } ]
		},
		"ordered-list": {
			/**
			 * Support: ordered and "numbered example" lists
			 * http://johnmacfarlane.net/pandoc/README.html#ordered-lists
			 */
			"name": "markup.list.ordered.markdown",
			"begin": "^\\s*(#\\.|(\\d+|[A-z]|[IVXLCDM]+|[ivxlcdm]+)[\\.\\)]|\\((\\d+|[A-z]|[IVXLCDM]+|[ivxlcdm]+)\\)|\\(\\@[\\w\\-]*\\))\\s+",
			"captures": {
				"1": { "name": "punctuation.definition.list.ordered.markdown" },
			},
			"end": "(\\n|$)",
			"patterns": [ { "include": "#inline" } ]
		},

		/* BLOCK: Horizontal Rule */
		"horizontal-rule": {
			"name": "markup.separator.markdown",
			"match": "^(\\s*[_\\-\\*]\\s*){3,}$",
			"comment": "*** or --- or ___ or somesuch",
		},

		/* BLOCK: Link Definition */
		"link-definition": {
			"name": "meta.link.definition.markdown",
			"match": "^[ ]{0,3}(\\[)(.*?)(\\]:)\\s+(\\S+)\\s*([\"'\\(].*?[\"'\\)])?",
			"captures": {
				"1": { "name": "punctuation.definition.link.inline.markdown" },
				"2": { "name": "markup.underline.link.reference" },
				"3": { "name": "punctuation.definition.link.inline.markdown" },
				"4": { "name": "markup.underline.link.url.markdown" },
				"5": { "name": "string.other.link.title.markdown" },
			},
		},

		/* BLOCK: Blockquote */
		"blockquote": {
			"name": "markup.quote.markdown",
			"begin": "^[ ]{0,3}(>)\\s*",
			"captures": {
				"1": { "name": "punctuation.definition.markup.quote.markdown" },
			},
			"end": "(\\n|$)",
			"patterns": [ { "include": "#inline" } ]
		},

		/* BLOCK: Paragraph */
		"paragraph": {
			"name": "meta.paragraph.markdown",
			"begin": "^",
			"end": "\\n",
			"patterns": [ { "include": "#inline" } ]
		},

		/* INLINE Elements - - - - - - - - - - - - - - - - - - - - - */

		"inline": {
			"patterns": [
				{ "include": "#backslash-escape" },
				{ "include": "#inline-code" },
				{ "include": "#bold" },
				{ "include": "#italic" },
				{ "include": "#strikethrough" },
				{ "include": "#inline-link" },
				{ "include": "#inline-reference-link" },
				{ "include": "#link-url"},
				{ "include": "#link-email"},
				{ "include": "#critic-markup" },
				{ "include": "#valid-markdown" },
				{ "include": "#etcetera" },
				{ "include": "text.html.basic" },
			]
		},

		/* INLINE: Bold */
		"bold":  {
			"comment": "**bold** or __strong__",
			"name": "markup.bold.markdown",
			// "match": "(\\*\\*|__)(.*?)(\\1)",
			"begin": "(\\*\\*|__)(.*?)",
			"end": "(\\1)",
			"captures": {
				"1": { "name": "punctuation.definition.bold.markdown" },
			},
			"patterns": [ { "include": "#inline" } ],
		},

		/* INLINE: Italic */
		"italic": {
			"comment": "*italic* or _strong_",
			"name": "markup.italic.markdown",
			// "match": "(\\*|_)(.*?)(\\1)",
			"begin": "(\\*|_)(.*?)",
			"end": "(\\1)",
			"captures": {
				"1": { "name": "punctuation.definition.italic.markdown" },
			},
			"patterns": [ { "include": "#inline" } ],
		},

		/* INLINE: Strikethrough */
		"strikethrough":  {
			"name": "markup.strikethrough.markdown",
			"begin": "(\\~\\~|__)(.*?)",
			"end": "(\\1)",
			"captures": {
				"1": { "name": "punctuation.definition.strikethrough.markdown" },
			},
			/**
			 * This should be included, if real strikethrough is implemented.
			 */
			// "patterns": [ { "include": "#inline" } ],
		},

		/* INLINE: Inline Link, incl. images */
		"inline-link": {
			"name": "meta.link.inline.markdown",
			"match": "(!?\\[)(.*?)(\\]\\()(\\S+)\\s*(\".*?\")?\\s*(\\))",
			"captures": {
				"1": { "name": "punctuation.definition.link.inline.markdown" },
				"2": { "name": "string.other.link.inline.markdown" },
				"3": { "name": "punctuation.definition.link.inline.markdown" },
				"4": { "name": "markup.underline.link.url.markdown" },
				"5": { "name": "string.other.link.title.markdown" },
				"6": { "name": "punctuation.definition.link.inline.markdown" },
			},
		},

		/* INLINE: Reference Link, incl. images */
		"inline-reference-link": {
			"name": "meta.link.inline.reference.markdown",
			"match": "(!?\\[)(.*?)(\\][ ]?\\[)(.*?)(\\])",
			"captures": {
				"1": { "name": "punctuation.definition.link.inline.markdown" },
				"2": { "name": "string.other.link.inline.markdown" },
				"3": { "name": "punctuation.definition.link.inline.markdown" },
				"4": { "name": "markup.underline.link.reference.markdown" },
				"5": { "name": "punctuation.definition.link.inline.markdown" },
			},
		},

		/* INLINE: Escape */
		"backslash-escape": {
			/**
			 * Support: http://daringfireball.net/projects/markdown/syntax#backslash
			 */
			"name": "constant.character.escape.backslash",
			"match": "\\\\[\\\\`\\*_{}\\[\\]\\(\\)#\\+-\\.!]",
		},

		/* INLINE: Inline Code */
		"inline-code":  {
			"name": "markup.raw.inline.markdown",
			"begin": "(`{1,2})(.*?)",
			"end": "(\\1)",
			"captures": {
				"1": { "name": "punctuation.definition.raw.inline.markdown" },
			},
		},

		/* INLINE: URL Link */
		"link-url": {
			"name": "markup.underline.link.url.markdown",
			"match": "(https?:\\/\\/)([\\da-z\\.-]+)\\.([a-z\\.]{2,6})([\\/\\w\\.\\-\\?=&#\\+]*)*\\/?",
			/**
			 * regex from http://net.tutsplus.com/tutorials/other/8-regular-expressions-you-should-know/
			 * - minus support for ` `
			 * - plus support for `?`, `=`, `&`, `#`, '+'
			 * - plus escaped `-`
			 */
		},

		/* INLINE: Email Link */
		"link-email": {
			"name": "markup.underline.link.email.markdown",
			"match": "([a-z0-9_\\.-]+)@([\\da-z\\.-]+)\\.([a-z\\.]{2,6})",
			// regex from http://net.tutsplus.com/tutorials/other/8-regular-expressions-you-should-know/
		},

		/* INLINE: Critic Markup */
		"critic-markup": {
			"patterns": [
				{ "include": "#addition" },
				{ "include": "#deletion" },
				{ "include": "#substitution" },
				{ "include": "#comment" },
				{ "include": "#highlight" },
			]
		},
		"addition": {
			/* Example: {++additon++} */
			"name": "meta.addition.criticmarkup",
			"match": "({\\+\\+)(.*?)(\\+\\+})",
			"captures": {
				"1": { "name": "punctuation.definition.inserted.criticmarkup" },
				"2": { "name": "markup.inserted.criticmarkup" },
				"3": { "name": "punctuation.definition.inserted.criticmarkup" }
			},
		},
		"deletion": {
			/* Example: {--deletion--} */
			"name": "meta.deletion.criticmarkup",
			"match": "({--)(.*?)(--})",
			"captures": {
				"1": { "name": "punctuation.definition.deleted.criticmarkup" },
				"2": { "name": "markup.deleted.criticmarkup" },
				"3": { "name": "punctuation.definition.deleted.criticmarkup" }
			},
		},
		"substitution": {
			/* Example: {~~changes~>substitution~~} */
			"name": "meta.substitution.criticmarkup",
			"match": "({~~)(.+?)(~>)(.+?)(~~})",
			"captures": {
				"1": { "name": "punctuation.definition.changed.criticmarkup" },
				"2": { "name": "markup.changed.criticmarkup" },
				"3": { "name": "punctuation.definition.changed.criticmarkup" },
				"4": { "name": "markup.changed.criticmarkup" },
				"5": { "name": "punctuation.definition.changed.criticmarkup" }
			},
		},
		"comment": {
			/* Example: {>>comment<<} */
			"name": "meta.comment.criticmarkup",
			"match": "({>>)(.*?)(<<})",
			"captures": {
				"1": { "name": "punctuation.definition.comment.criticmarkup" },
				"2": { "name": "markup.comment.criticmarkup" },
				"3": { "name": "punctuation.definition.comment.criticmarkup" }
			},
		},
		"highlight": {
			/* Example: {==hightlight==}{>>comment<<} */
			"name": "meta.highlight.criticmarkup",
			"match": "({==)(.*?)(==})(?={>>.*?<<})",
			"captures": {
				"1": { "name": "punctuation.definition.highlight.criticmarkup" },
				"2": { "name": "markup.highlight.criticmarkup" },
				"3": { "name": "punctuation.definition.highlight.criticmarkup" }
			},
		},

		/* INLINE: Valid Markdown */
		"valid-markdown": {
			/**
			 * Style ampersands, before the HTML syntax declares them invalid
			 */
			"name": "valid.markdown",
			"match": "&",
		},

		/* INLINE: Tag */
		"tag": {
			/* Source: https://github.com/alehandrof/MarkDo */
			"patterns": [
				{ "include": "#at-tag" },
				{ "include": "#hash-tag" },
			]
		},
		"at-tag": {
			/* Example: #important or #project(x)*/
			"name": "color.green markup.tag.hash.markdo",
			"match": "(?<=^|\\s)(#)[\\w\\d-]+",
			"patterns": [ { "include": "#tag-optional-value" } ]
		},
		"hash-tag": {
			/* Example: @work or @phone(555-1234) */
			"name": "color.cyan markup.tag.at.markdo",
			"match": "(?<=^|\\s)(@)[\\w\\d-]+",
			"patterns": [ { "include": "#tag-optional-value" } ]
		},
		"tag-optional-value": {
			"name": "markup.tag.optional-value.markdo",
			"match": "\\G(\\([\\w\\d-]+\\))",
		},

		/* Legacy stuff I haven't processed, yet. */
		"etcetera": {
			"patterns": [
				/*{
					"name": "comment tag.structure.markdo",
					"match": "(?<=^|\\s)(#|@)(added|done|canceled|cancelled)(:[-\\d]+)?(?=\\s|\\n|$)",
					"comment": "@added:2011-11-11 #done",
				},*/
				/*{
					"name": "action.markdo",
					// "begin": "^\\s*([-\\+\\*]\\s+)?(\\[[ ]\\]\\s+)",
					"begin": "\\G(\\[[ ]\\]\\s+)",
					"captures": {
						"1": { "name": "color.orange checkbox.action.markdo" }
					},
					// "end": "(?=\\n)",
					"end": "(?=\\n|$)",
					"patterns": [
						{ "include": "#inline" },
					]
				},
				{
					"name": "comment action.markdo completed.action.markdo",
					// "begin": "^\\s*([-\\+\\*]\\s+)?(\\[[xX]\\]\\s+)",
					"begin": "\\G(\\[[xX]\\]\\s+)",
					"captures": {
						"1": { "name": "comment checkbox.action.markdo" }
					},
					"end": "(?=\\n|$)",
					// "patterns": [
					//	{ "include": "#inline" },
					// ]
				},*/
				{
					"name": "comment meta.tag.markdo",
					"match": "(?<=^|\\s)(\\+|x|\\.)([-\\d]+)(?=\\s|\\n|$)",
					"comment": "+2011-11-11 x2012-12-12",
				},

				{
					"name": "color.purple markup.underline.link meta.bracket-link.markdown",
					"match": "(\\[\\[)(.+?)(\\]\\])",
					"captures": {
						"1": { "name": "punctuation.definition.bracket-link.markdown" },
						"2": { "name": "markup.underline.bracket-link.markdown" },
						"3": { "name": "punctuation.definition.bracket-link.markdown" }
					},
					"comment": "[[Search for this in Goto Anywhere]]"
				},
			]
		},
	},
}
